import xml.etree.ElementTree as ET

def extract_services(xml_file):
    tree = ET.parse(xml_file)
    root = tree.getroot()
    services = []

    for host in root.findall("host"):
        for port in host.findall(".//port"):
            service = port.find("service")
            if service is None:
                continue

            product = service.get("product")
            version = service.get("version")

            if not product or not version:
                continue  # cannot map CVEs

            services.append({
                "port": port.get("portid"),
                "proto": port.get("protocol"),
                "product": product.lower(),
                "version": version
            })

    return services
